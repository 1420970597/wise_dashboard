(function(){"use strict";let r=0,c=0,s,o,t;onmessage=async function(f){try{const{operation:n,arrayBuffer:i,fileName:l}=f.data;switch(n){case 1:{const a=new DataView(i);c=Number(a.getBigUint64(4,!1)),r=0,s=await navigator.storage.getDirectory(),o=await s.getFileHandle(l,{create:!0}),t=await o.createSyncAccessHandle();const e=i.slice(12);r+=e.byteLength,t.write(e,{at:0}),postMessage({type:1,progress:"got handle"});break}case 2:{if(!t)throw new Error("accessHandle is undefined");if(t.write(i,{at:r}),r+=i.byteLength,r===c){t.flush(),t.close();const a=await o.getFile(),e=new Blob([a],{type:"application/octet-stream"});postMessage({type:2,blob:e,fileName:l})}break}case 3:{for await(const[a,e]of s.entries())e.kind==="file"?await s.removeEntry(a):e.kind==="directory"&&await s.removeEntry(a,{recursive:!0});break}}}catch(n){n instanceof Error&&postMessage({type:0,error:n.message})}}})();
